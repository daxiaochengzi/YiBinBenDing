


@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Index.cshtml";
}
<!DOCTYPE html>
<script>

    $(function () {
        initControl();
        gridList();
        reportExcelIni();

    });
    function initControl() {
        $("#OrganizeSelect").bindSelect({
            url: "/SystemManage/Organize/GetListData",
            id: "F_EnCode",
            text: "F_FullName"
        });
    }
    function gridList() {
        var $gridList = $("#gridList");
        $gridList.dataGrid({
            url: "/SystemManage/MedicalExpenseReport/GetGridMonthJson",
            height: $(window).height() - 96,
            postData:
            {
                Date:'2021-01',
                OrganizationCode: $("#OrganizeSelect").val()
            },
            colModel: [
                { label: "主键", name: "Day", hidden: true, key: true },
                { label: '日期', name: 'Day', width: 120, align: 'left' },
                { label: '一般诊疗费人次', name: 'Frequency', width: 120, align: 'left' },
                { label: '门诊费用', name: 'MedicalTreatmentTotalCost', width: 120, align: 'left' },
                { label: '报销金额', name: 'ReimbursementExpensesAmount', width: 200, align: 'left' },
               
               
            ],
          
            viewrecords: true
        });
        $("#btn_search").click(function () {
            reportExcelIni();
            $gridList.jqGrid('setGridParam',
                {
                    postData:
                    {
                        Date:'2021-01',
                        OrganizationCode: $("#OrganizeSelect").val()
                    }
                }).trigger('reloadGrid');

        });
    }

  
    //导出链接初始化
    function reportExcelIni() {
      
        var url = "/api/BenDing/MedicalExpenseReport?";
        url += "UserId=" + $("#UserId").val();
        url += "&StartTime=" + $("#startTime").val();
     
        url += "&OrganizationCode=" + $("#OrganizeSelect").val();

        $('#btn_MedicalExpenseReport').attr('href', url);

    }


</script>
<div class="topPanel">
    <div class="toolbar" style="float: left">

        <div class="btn-group" style="margin-left: 20px; width: 150px;height: 32px;">
            <select id="OrganizeSelect" class="form-control" style="padding: 0px;height: 32px;"></select>
        </div>
        
        @*<div class="btn-group" style="margin-left: 10px;">
                <span>机构名称:</span>
            </div>
            <div class="btn-group" style="height: 30px;">
                <input id="txt_OrganizationName" type="text" class="form-control" placeholder="机构名称" style="width: 100px; height: 20px">
            </div>*@
        <div class="btn-group" style="margin-left: 5px;">
            开始日期：
            <input type="text" class="Wdate" name="SettlementStartTime" id="startTime"
                   onClick="WdatePicker({ autoPickDate: true, dateFmt: 'yyyy-MM-dd', maxDate: '#F{$dp.$D(\'startTime\')||\'new Date()\'}', readOnly: true });" style="width: 120px;" />
            结束日期：
            <input type="text" class="Wdate" name="SettlementEndTime" id="endTime"
                   onClick="WdatePicker({ autoPickDate: true, dateFmt: 'yyyy-MM-dd', minDate: '#F{$dp.$D(\'endTime\')}', maxDate: new Date(), readOnly: true });" style="width: 120px;" />
        </div>
        <div class="btn-group" style="margin-left: 5px;">
            <a class="btn btn-primary" id="btn_search">查询</a>
        </div>
        <div class="btn-group" style="margin-left: 5px;">
            <a class="btn btn-primary" id="btn_MedicalExpenseReport" href="/api/BenDing/MedicalExpenseReport">导出</a>
        </div>
        <div class="operate">
            <ul class="nav nav-pills">
                <li class="first">已选中<span>1</span>项</li>
                <li><a id="NF-Details" onclick="btn_details()"><i class="fa fa-search-plus"></i>查看明细</a></li>
            </ul>
            <a href="javascript:;" class="close"></a>
        </div>
        <script>$('.toolbar').authorizeButton()</script>
    </div>

</div>
<div class="gridPanel">
    <table id="gridList"></table>
    <div id="gridPager"></div>
    <div>
        <input type="hidden" id="UserId" name="UserId" value="@ViewBag.empid" placeholder="用户ID" />
        <input type="hidden" id="OrganizationCode" name="UserId" value="@ViewBag.OrganizationCode" placeholder="组织机构" />
    </div>
</div>

